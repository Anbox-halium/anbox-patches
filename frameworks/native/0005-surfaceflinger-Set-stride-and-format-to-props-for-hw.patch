From 6d09eea2b08f3e63975ac10dfcb54fbb9326463c Mon Sep 17 00:00:00 2001
From: Erfan Abdi <erfangplus@gmail.com>
Date: Fri, 30 Apr 2021 04:28:22 +0800
Subject: [PATCH] surfaceflinger: Set stride and format to props for hwc hal

Change-Id: I9fc4b5d257851db37c2c6e0246da857c94ba1f65
---
 services/surfaceflinger/DisplayHardware/HWComposer.cpp | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/services/surfaceflinger/DisplayHardware/HWComposer.cpp b/services/surfaceflinger/DisplayHardware/HWComposer.cpp
index 1099041b4..d05e346c0 100644
--- a/services/surfaceflinger/DisplayHardware/HWComposer.cpp
+++ b/services/surfaceflinger/DisplayHardware/HWComposer.cpp
@@ -28,6 +28,7 @@
 #include <ui/GraphicBuffer.h>
 #include <utils/Errors.h>
 #include <utils/Trace.h>
+#include <cutils/properties.h>
 
 #include "HWComposer.h"
 #include "HWC2.h"
@@ -392,6 +393,11 @@ status_t HWComposer::setClientTarget(DisplayId displayId, uint32_t slot,
                                      ui::Dataspace dataspace) {
     RETURN_IF_INVALID_DISPLAY(displayId, BAD_INDEX);
 
+    if (target) {
+        //ALOGE("stride: %d", target->stride);
+        property_set("anbox.layer.stride", std::to_string(target->stride).c_str());
+        property_set("anbox.layer.format", std::to_string(target->format).c_str());
+    }
     ALOGV("%s for display %s", __FUNCTION__, to_string(displayId).c_str());
     auto& hwcDisplay = mDisplayData[displayId].hwcDisplay;
     auto error = hwcDisplay->setClientTarget(slot, target, acquireFence, dataspace);
-- 
2.25.1

